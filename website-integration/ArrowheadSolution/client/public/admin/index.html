<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <link href="config.yml" type="text/yaml" rel="cms-config-url">
</head>
<body>
  <script>
    (function () {
      // OAuth popup handshake fallback:
      // If Decap CMS misses the postMessage or doesn't auto-update the UI,
      // reload the page shortly after receiving a success message.
      var reloaded = sessionStorage.getItem('cms-oauth-reloaded') === '1';
      window.addEventListener('message', function (e) {
        try {
          var msg = e.data;
          if (typeof msg === 'string') {
            // Minimal debug to aid diagnosis
            if (msg.indexOf('authorizing:github') === 0) {
              try { console.debug('[CMS OAuth] authorizing message received'); } catch (_) {}
            }
            if (msg.indexOf('authorization:github:success:') === 0) {
              try { console.debug('[CMS OAuth] success message received'); } catch (_) {}
              if (!reloaded) {
                sessionStorage.setItem('cms-oauth-reloaded', '1');
                // Allow the CMS a short window to persist the token, then reload
                setTimeout(function () { location.reload(); }, 800);
              }
            }
          }
        } catch (err) { /* no-op */ }
      }, false);
    })();
  </script>
  <!-- Load Decap CMS with a cache-busting param to avoid stale client -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js?v=2"></script>
</body>
</html>
