---
**STATUS: SUPERSEDED - HISTORICAL ARCHIVE**  
This document is preserved for historical reference only.  
**Current version:** SLAD_v5.2_Final.md  
**Archived:** October 23, 2025  
---

# System Logic & Architecture Document (SLAD)

- Version: 5.1
- Date: August 20, 2025
- Status: Final – Grounded Baseline

This document captures the core technical architecture, data flow, programming conventions, and component breakdown for the Project Arrowhead application. It is the primary technical guide, defining how the system is built.

---

## 1.0 Document Purpose

Define the authoritative, code-grounded technical baseline for Project Arrowhead’s current architecture. This SLAD describes the system as implemented, not aspirationally.

---

## 2.0 Core Architectural Principles

- Principle of Logic/UI Separation
  - Business logic (data manipulation, API services) is kept separate from rendering logic (React components).
- Principle of Single Responsibility
  - Each component, hook, or function should do one thing and do it well.
- Principle of Decoupled Verification
  - The test execution environment must be independent of the application server environment.
- Principle of Sequential Module Flow
  - Navigation between modules must maintain the original user journey: Brainstorm → Choose → Objectives → Dashboard.

---

## 3.0 High‑Level Architecture

- Technology Stack
  - Frontend: React 18, TypeScript, Vite, Wouter (routing), Tailwind CSS.
  - Backend: Node.js, Express, TypeScript.
  - Persistence (Current): In‑memory storage (`website-integration/ArrowheadSolution/server/storage.ts`). Drizzle ORM is used for schema definition and types; database integration is pending.
- Structure
  - Monorepo at `website-integration/ArrowheadSolution/`.
  - React Single‑Page Application (SPA) in `client/` is served by and communicates with a backend Express API in `server/`.
- Path Aliases
  - `tsconfig.json` configures:
    - `@/*` → `client/src/*`
    - `@shared/*` → `shared/*`

---

## 4.0 File Structure Manifest

- `client/src/pages/`
  - Primary page components (e.g., `JourneyDashboard.tsx`, `JourneyStepPage.tsx`).
- `client/src/components/`
  - Reusable React components (e.g., `GlobalSidebar.tsx`, `StepProgress.tsx`).
- `client/src/hooks/`
  - Custom React hooks (notably `useJourney.ts` for state/session management).
- `client/src/services/`
  - Dedicated API service layer (`journeyApi.ts`).
- `server/`
  - Backend Express application, including `index.ts` (entry), `routes.ts` (API definitions), and `storage.ts` (in‑memory data handling).
- `shared/`
  - Code shared between client and server, primarily the Drizzle ORM `schema.ts`.

---

## 5.0 Data Model & Session Handling

- Schema
  - Defined in `shared/schema.ts` using Drizzle ORM.
- Primary Keys
  - All database tables use serial integers as primary keys. No UUIDs are currently in use.
- Session ID
  - A string `sessionId` (e.g., `guest_<timestamp>_<random>`) is generated by `useJourney.ts` on the client. It is stored in `localStorage` and used to identify user sessions across the application (including tasks association).

---

## 6.0 API Endpoints

All endpoints are prefixed with `/api` and defined in `server/routes.ts`.

- Blog
  - `GET /api/blog/posts`
  - `GET /api/blog/posts/:slug`
- Users
  - `POST /api/users/register`
- Email
  - `POST /api/email/subscribe`
- Journey Sessions
  - `POST /api/journey/sessions`
  - `GET /api/journey/sessions/:sessionId`
  - `PUT /api/journey/sessions/:sessionId`
  - `GET /api/journey/sessions` (list; supports `?sessionId=` filter)
  - `GET /api/journey/sessions/:sessionId/export`
- Tasks
  - `POST /api/tasks`
  - `GET /api/tasks` (list; supports `?sessionId=` filter)
  - `GET /api/tasks/session/:sessionId`
  - `PUT /api/tasks/:taskId`
  - `DELETE /api/tasks/:taskId`
- Progress
  - `GET /api/journey/progress/:sessionId`
- Exports (JSON)
  - `GET /api/journey/sessions/:sessionId/export`
  - `GET /api/journey/export/full/:sessionId`

---

## 7.0 Local Development & Testing Workflow

- Development Server
  - From `website-integration/ArrowheadSolution/`, run `npm run dev`.
  - This single command starts the Express server and attaches the Vite dev middleware; both the API and client are served on port 5000 (or `PORT`).
- Testing Setup
  - Root Parity Tests (Jest + Puppeteer): From project root, run `npm test`.
  - Application E2E Tests (Playwright): From `website-integration/ArrowheadSolution/`, run `npm run test:e2e`.
    - Playwright is configured with `webServer` to automatically start the dev server in CI and reuse a local server when available.

---

## 8.0 Known Gaps & Discrepancies

The following inconsistencies between the client and server are identified and tracked for cleanup:

- Export Route Mismatch
  - The client `journeyApi.ts` calls an export endpoint that differs from what the server exposes.
- Missing Task Route
  - The client has a `getTask(taskId)` method, but the server lacks `GET /api/tasks/:taskId`.
- Task ID Mismatch
  - The client identifies tasks by a numeric `id`, while the in‑memory backend keys tasks by a generated string identifier. This can cause update/delete issues.
- Journey Progress Response Shape
  - Client `journeyApi.getJourneyProgress()` expects `{ sessions, tasks, totalSteps, completedSteps, progressPercentage }`, but server returns `{ module, currentStep, completedSteps, isCompleted, totalSteps }`. Either adjust the client or extend the server response.
- Database Migration
  - Persistence must migrate from in‑memory to PostgreSQL using the existing Drizzle schemas.

---

## 9.0 Grounding Notes (File Paths)

- Dev script: `website-integration/ArrowheadSolution/package.json` → `scripts.dev` (`tsx server/index.ts`)
- Server entry: `server/index.ts` (port `PORT` or 5000; Vite middleware in development)
- API routes: `server/routes.ts`
- Schema and types: `shared/schema.ts` (serial integer PKs)
- Path aliases: `tsconfig.json` (`@/*`, `@shared/*`)
- E2E config: `playwright.config.ts` (`webServer` with `npm run dev`, baseURL `http://localhost:5000`)
